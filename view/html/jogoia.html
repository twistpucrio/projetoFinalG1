<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Construtor de Agentes de IA</title>
    <link rel="stylesheet" href="../estilo/jogoia.css">
    <script type="module" src="../../controller/controle-randomPerguntas.js"></script> 

</head>
<body>

    <h1>Construtor de Agentes: Robô de Limpeza</h1>
    
    <div id="app-container">
        <div id="configuracao">
            <h2>Regras Dinâmicas</h2>
            <p>Defina uma regra: SE (Percepção) ENTÃO (Ação)</p>
            
            <div class="regra-item">
                <label>SE:</label>
                <select id="select-percepcao">
                    <option value="celula_atual_suja">Célula Atual está <strong>suja</strong></option>
                    <option value="celula_atual_limpa">Célula Atual está <strong>limpa</strong></option>
                    <option value="todas_limpas">O ambiente está <strong>limpo</strong></option>
                </select>

                <label>ENTÃO:</label>
                <select id="select-acao">
                    <option value="limpar"><strong>Limpar</strong> Célula Atual</option>
                    <option value="mover_aleatorio"><strong>Mover</strong> aleatoriamente</option>
                    <option value="parar"><strong>Parar</strong> Agente</option>
                </select>

                <button onclick="adicionarRegra()">Adicionar Regra</button>
            </div>

            <h3>Lista de Regras Ativas:</h3>
            <div id="lista-regras">
                </div>
        </div>

        <div id="simulacao">
            <h2 id="h22">Simulação do Ambiente - Agente Reativo Simples</h2>
            <div id="ambiente"></div>

            <div id="controles">
                <button onclick="iniciarSimulacao()">Reiniciar Ambiente</button>
                <button onclick="rodarUmCiclo()">Executar Próxima Ação</button>
            </div>

            <h3>Log de Decisões:</h3>
            <div id="log"></div>
        </div>
        <button id="reiniciar-btn">Voltar</button>
    </div>

<script>

    let estadoAmbiente = []; 
    let posicaoAgente = 0;
    let regrasAgente = []; 

    function logDecisao(mensagem) {
        const log = document.getElementById('log');
        log.innerHTML += `<div>> ${mensagem}</div>`;
        log.scrollTop = log.scrollHeight;
    }

   function renderizarAmbiente() {
    const ambienteDiv = document.getElementById('ambiente');
    ambienteDiv.innerHTML = ''; 

    estadoAmbiente.forEach((estado, index) => {
        const celula = document.createElement('div');
        celula.className = `celula ${estado}`;
        
       
        if (index === posicaoAgente) {
            celula.classList.add('agente'); 
            
            
            const roboImg = document.createElement('img');
            
            roboImg.src = '/view/img/robo-ia.png';
            
            roboImg.style.width = '100%'; 
            roboImg.style.height = '100%';
            roboImg.style.objectFit = 'contain'; 
            
            celula.textContent = ''; 
            
            celula.appendChild(roboImg);
        }

        ambienteDiv.appendChild(celula); 
    });
}

    function exibirRegras() {
        const listaDiv = document.getElementById('lista-regras');
        listaDiv.innerHTML = '';

        if (regrasAgente.length === 0) {
            listaDiv.innerHTML = '<p>Nenhuma regra definida. O Agente não sabe o que fazer!</p>';
            return;
        }

        regrasAgente.forEach((regra, index) => {
            const item = document.createElement('div');
            item.className = 'regra-item';
            
            const percepcaoFormatada = regra.percepcao.replace(/_/g, ' ').toUpperCase();
            const acaoFormatada = regra.acao.replace(/_/g, ' ').toUpperCase();

            item.innerHTML = `
                <span>Regra ${index + 1}: SE <strong>${percepcaoFormatada}</strong> ENTÃO <strong>${acaoFormatada}</strong></span>
                <button onclick="removerRegra(${index})">X</button>
            `;
            listaDiv.appendChild(item);
        });
    }


    function adicionarRegra() {
        const percepcao = document.getElementById('select-percepcao').value;
        const acao = document.getElementById('select-acao').value;

        const novaRegra = { percepcao, acao };

        regrasAgente.push(novaRegra);
        exibirRegras();
        logDecisao(`Regra adicionada: SE ${percepcao} ENTÃO ${acao}`);
    }

    function removerRegra(index) {
        regrasAgente.splice(index, 1);
        exibirRegras();
        logDecisao(`Regra ${index + 1} removida. O cérebro foi modificado.`);
    }


    function perceber() {
        if (estadoAmbiente[posicaoAgente] === 'sujo') return 'celula_atual_suja';
        
        if (estadoAmbiente.every(estado => estado === 'limpo')) return 'todas_limpas';
        
        return 'celula_atual_limpa';
    }

    function rodarUmCiclo() {
        if (regrasAgente.length === 0) {
            logDecisao('ERRO: O agente não tem regras e não pode agir.');
            return;
        }

        const percepcaoAtual = perceber();
        
   
        const regraEncontrada = regrasAgente.find(regra => regra.percepcao === percepcaoAtual);

        if (!regraEncontrada) {
            logDecisao(`Nenhuma regra para a percepção '${percepcaoAtual.replace(/_/g, ' ')}'. Agente fica inerte.`);
            return;
        }

        logDecisao(`[DECISÃO] Percepção: ${percepcaoAtual}. Ação Escolhida: ${regraEncontrada.acao}`);
        executarAcao(regraEncontrada.acao);
        renderizarAmbiente();
    }

    function executarAcao(acao) {
        if (acao === 'limpar') {
            estadoAmbiente[posicaoAgente] = 'limpo';
        } 
        else if (acao === 'mover_aleatorio') {
            let novoPosicao;
            do {
                novoPosicao = Math.floor(Math.random() * estadoAmbiente.length);
            } while (novoPosicao === posicaoAgente);
            posicaoAgente = novoPosicao;
        }
        else if (acao === 'parar') {
            document.getElementById('controles').innerHTML = '<h2> Objetivo Atingido!</h2>';
        }
    }


    function iniciarSimulacao() {
        estadoAmbiente = ['sujo', 'sujo', 'limpo', 'sujo', 'limpo', 'sujo', 'limpo', 'sujo', 'sujo'];
        posicaoAgente = 0;
        document.getElementById('log').innerHTML = ''; // Limpa o log
        
        document.getElementById('controles').innerHTML = `
            <button onclick="iniciarSimulacao()">Reiniciar Ambiente</button>
            <button onclick="rodarUmCiclo()">Executar Próxima Ação</button>
        `;
        
        renderizarAmbiente();
        logDecisao('Simulação reiniciada. Crie as regras para o Robô!');
    }

    iniciarSimulacao();
    exibirRegras();
</script>
</body>
</html>